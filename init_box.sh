#!/bin/bash

read -p "Enter box name: " name
read -p "Enter target ip address: " ip
cd /home/kali/boxhack
mkdir -p $name
cd $name

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Running nMapAutomator first..."
echo "------------------------------------------------------------------------------------------------------------------------------------"
cp /opt/nmapAutomator/nmapAutomator.sh .
./nmapAutomator.sh -H $ip -t Recon

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Running dirsearch..."
echo "------------------------------------------------------------------------------------------------------------------------------------"

dirsearch -u $ip -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Running autorecon..."
echo "------------------------------------------------------------------------------------------------------------------------------------"

env "PATH=$PATH" autorecon $ip

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Drop into AutoRecon Results"
echo "------------------------------------------------------------------------------------------------------------------------------------"

cd results/$ip

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Connect with Netcat to all open ports & output result"
echo "------------------------------------------------------------------------------------------------------------------------------------"

for i in $(echo ${PWD##*/}|tr "," "\n"); do grep -E 'tcp\s+open' $(pwd)/scans/_full_tcp_nmap.txt | awk -F / '{print $1}' | awk 'BEGIN { ORS = "\n" } { print }' | xargs -i nc -w 3 -vn $i {}; done

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Curl all open ports"
echo "------------------------------------------------------------------------------------------------------------------------------------"

for port in `grep -E 'tcp\s+open' $(pwd)/scans/_full_tcp_nmap.txt | awk -F / '{print $1}' | awk 'BEGIN { ORS = " " } { print }'`; do IP=${PWD##*/};RED='\033[0;31m';NC='\033[0m';echo ${RED}"http://"$IP":"$port;echo ${NC}; curl -m 1 $IP":$port"; printf "\n";printf "\n";printf "===============================";printf "\n"; done

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Curl all website pages found but exclude pages that are CSS or returned a 403"
echo "------------------------------------------------------------------------------------------------------------------------------------"

for link in `grep -Ev '(403|.css)' $(pwd)/scans/tcp80/tcp_80_http_feroxbuster_dirbuster.txt | awk -F ' ' '{print $5}' | awk 'BEGIN { ORS = " " } { print }'`; do RED='\033[0;31m';NC='\033[0m';echo ${RED}$link;echo ${NC}; curl -m 2 $link; printf "\n";printf "\n";printf "===============================";printf "\n"; done

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Curl all website pages found on port 80 which is handy if not too many. Change the port to suit"
echo "------------------------------------------------------------------------------------------------------------------------------------"

for link in `cat $(pwd)/scans/tcp80/tcp_80_http_feroxbuster_dirbuster.txt | awk -F ' ' '{print $5}' | awk 'BEGIN { ORS = " " } { print }'`; do RED='\033[0;31m';NC='\033[0m';echo ${RED}$link;echo ${NC}; curl -m 2 $link; printf "\n";printf "\n";printf "===============================";printf "\n"; done

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Curl the disallowed entries from robots.txt"
echo "------------------------------------------------------------------------------------------------------------------------------------"

for url in `grep -E 'Disallow:' robots.txt | awk '{print $2}'`; do RED='\033[0;31m';NC='\033[0m';echo ${RED}"http://"${PWD##*/}$url;echo ${NC};curl -s -m 2 ${PWD##*/}$url | grep -v "403 - Forbidden: Access is denied";printf "===============================";printf "\n"; done

echo "------------------------------------------------------------------------------------------------------------------------------------"
echo "Simply extract an open port list"
echo "------------------------------------------------------------------------------------------------------------------------------------"

grep -E 'tcp\s+open' $(pwd)/scans/_full_tcp_nmap.txt | awk -F / '{print $1}' | awk 'BEGIN { ORS = " " } { print }'




